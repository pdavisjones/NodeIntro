<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
    // Riel's Query Function
    function querySheet(query, id, sheet, callback) {
        var cb = "cB" + Math.random().toString(36).substr(2, 5);
        ajaxStart();
        
        $.ajax({
            url: "https://docs.google.com/spreadsheets/d/" + id + "/gviz/tq",
            jsonpCallback: cb,

        // Tell jQuery we're expecting JSONP
        dataType: "jsonp",

        // Url parameters:
        data: {
        headers: 1,
        sheet: sheet,
        tq: query,
        tqx: "responseHandler:" + cb,

        //access_token: googleauththoken-only_for_non_public
        }
        })
        .success(function (json) {
            if (json.status == "ok") {
                callback(getArrayFromGvizTable(json));
            } else {
                console.log(json);
                alert("Er is een fout opgetreden: \r\n" + json.errors[0].message + "\r\n" + json.errors[0].reason + "\r\n" + json.errors[0].detailed_message);
            }
        })
        .fail(function (jqXHR, error, errorThrown) {
            ajaxStop();
            alert("Geen toegang");
            console.log("Spreadsheet: " + errorThrown);
        });
//ajaxStop();
    }
    
    function getArrayFromGvizTable(json) {
        var m = json.table;
        var mheaders = m.cols;
        var pheaders = {};
        mheaders.forEach(function (element, index) {
        pheaders[element.label] = index;
    });
    
    var rowarray = [];
    
    for (var i = 0; i < m.rows.length; i++)
        { var a={}; for (var key in pheaders) { 
            var strippedKey=key.toLowerCase().replace(/ /, "" ); if (m.rows[i]["c"][pheaders[key]] && m.rows[i]["c"][pheaders[key]]["v"]) { a[strippedKey]=m.rows[i]["c"][pheaders[key]]["v"]; } else { a[strippedKey]=""; } } rowarray.push(a); } return rowarray; }

        // This is Amit's Email Function //
        // $(document).ready(function () {
        //     $('select').formSelect();
        // });
        // // create an object with the input field values and send an email with it
        // function sendEmail(e) {
        //     e.preventDefault();
        //     var data = {
        //         from: $("#from").val(),
        //         to: $("#to").val(),
        //         subject: $("#subject").val(),
        //         body: $("#body").val()
        //     };
        //     $("button").attr("disabled", "disabled");
        //     //            alert("You just submitted " + JSON.stringify(data)); 
        //     google.script.run.withSuccessHandler(function (text) {
        //         M.toast({
        //             html: text
        //         });
        //         $("button").removeAttr("disabled");
        //     }).sendEmail(data);
        // }
    </script>
</head>

<body>
    <div class="container">
        <div class="row">
        </div>
            <div class="row">
                <div class="input-field col s12">
                    <input type="email" placeholder="Enter your wallet number here" id="to">
                    <label for="walletNo">Eazl Wallet Number</label>
                </div>
                <div class="input-field col s12">
                    <input type="text" placeholder="Enter your wallet key here" id="subject">
                    <label for="subject">Wallet Key <a href="https://eazlblog.com/eazl-student-center-faq/">(What's
                            this?)</a></label>
                </div>
            </div>
            <div class="row">
                <div class="col s12">
                    <button class="btn" type="submit">See My Balance</button>
                </div>
            </div>
    </div>
</body>

</html>